{% for message in app.flashes('error') %}
    <div style="color: red">{{ message }}</div>
{% endfor %}
{% for message in app.flashes('success') %}
    <div style="color: green">{{ message }}</div>
{% endfor %}

<h2>Manage Agents</h2>

{% if agents is not empty %}
<table id="agentsTable" class="display">
    <thead>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Role</th>
            <th>Date Created</th>
            <th>Agent ID</th>
            <th>Assigned Agent</th>
        </tr>
    </thead>
    <tbody>
        {% for agent in agents %}
            <tr>
                <td>{{ agent.id }}</td>
                <td>{{ agent.username }}</td>
                <td>{{ agent.role }}</td>
                <td>{{ agent.dateCreated|date('Y-m-d') }}</td>
                <td>
                    {% if agent.agent %}
                        {{ agent.agent.id }}
                    {% else %}
                        NAN
                    {% endif %}
                </td>
                <td>
                    <form method="POST" action="{{ path('assign_agent', {'userId': agent.id}) }}">
                        <select name="agent_id" class="form-control">
                            {% for otherAgent in agents %}
                                {% if otherAgent.id != agent.id %}  {# Исключаем назначение самому себе #}
                                    <option value="{{ otherAgent.id }}"
                                        {% if agent.agent and otherAgent.id == agent.agent.id %}
                                            selected
                                        {% endif %}
                                    >
                                        {{ otherAgent.username }}
                                    </option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        <input type="hidden" name="user_id" value="{{ agent.id }}">
                        <button type="submit">Assign</button>
                    </form>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
    <p><em>No agents found...</em></p>
{% endif %}