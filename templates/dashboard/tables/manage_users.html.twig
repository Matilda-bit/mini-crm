{# templates/dashboard/manage_users.html.twig #}

<h2 id="manage-users">Manage Users</h2>

{% include 'components/flash_messages.html.twig' with {
    'error': 'users_tb_error',
    'success': 'users_tb_success'
} %}

{% if users is not empty %}

<div style="margin-bottom: 10px;">
    <select id="columnSelect" style="padding: 5px;">
        <option value="all">Search All Columns</option>
        <option value="0">ID</option>
        <option value="1">Username</option>
        <option value="3">Date Created</option>
        <option value="4">Agent ID</option>
    </select>

    <input type="text" id="customSearch" placeholder="Search..." style="padding: 5px;">
</div>

<table id="usersTable" class="display">
    <thead>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Role</th>
            <th>Date Created</th>
            <th>Agent ID</th>
            <th>Assigned Agent</th>
        </tr>
    </thead>
    <tbody>
        {% for u in users %}
            <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.username }}</td>
                <td>{{ u.role }}</td>
                <td>{{ u.dateCreated|date('Y-m-d') }}</td>
                <td>
                    {% if u.agent %}
                        {{ u.agent.id }}
                    {% else %}
                        <span style="color: red;">N/A</span>
                    {% endif %}
                </td>
                <td>
                    <form method="POST" action="{{ path(route ~ '_assign_agent', {'userId': user.id, 'tableName' : 'users_tb' }) }}">
                        <select name="agent_id" class="form-control">
                            {% for agent in agents %}
                                <option value="{{ agent.id }}" {% if u.agent and agent.id == u.agent.id %}selected{% endif %}>
                                    {{ agent.username }} ({{ agent.id }})
                                </option>
                            {% endfor %}
                        </select>
                        <input type="hidden" name="user_id" value="{{ u.id }}">
                        <button type="submit">Assign</button>
                    </form>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
    <p><em>No users found...</em></p>
{% endif %}
