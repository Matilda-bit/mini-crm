<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</head>
<body>
    <form method="post" action="{{ path('app_logout') }}">
        <button type="submit">Logout</button>
    </form> <a href="{{ path('app_logout') }}">Logout</a>
    <h1>Welcome, {{ user.username }}</h1>
    <h3>User dashboard!</h3>
    <p><strong>Last Login:</strong> {{ user.loginTime ? user.loginTime|date('Y-m-d H:i:s') : 'Never' }}</p>
    <p><strong>Currency:</strong> {{ user.currency }}</p>
    <p><strong>Total PNL:</strong> {{ user.totalPnl }}</p>
    <p><strong>Equity:</strong> {{ user.equity }}</p>

    <h2>Open Trade</h2>
    <form action="/open-trade" method="POST">
        <label for="position">Position:</label>
        <select name="position" id="position">
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
        </select><br><br>

        <label for="lot_count">Lot Count:</label>
        <input type="number" name="lot_count" id="lot_count" min="0.1" max="100" step="0.1" required><br><br>

        <label for="sl">Stop Loss (SL):</label>
        <input type="number" name="sl" id="sl"><br><br>

        <label for="tp">Take Profit (TP):</label>
        <input type="number" name="tp" id="tp"><br><br>

        <button type="submit">Open Trade</button>
    </form>

    <h2>Open Trades</h2>
    <table id="trades" class="display">
        <thead>
            <tr>
                <th>Trade ID</th>
                <th>Position</th>
                <th>Entry Rate</th>
                <th>Lot Count</th>
                <th>Pip Value</th>
                <th>Margin</th>
                <th>Profit/Loss</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for trade in trades %}
                <tr>
                    <td>{{ trade.id }}</td>
                    <td>{{ trade.position }}</td>
                    <td>{{ trade.entry_rate }}</td>
                    <td>{{ trade.lot_count }}</td>
                    <td>{{ trade.pip_value }}</td>
                    <td>{{ trade.used_margin }}</td>
                    <td>{{ trade.pnl }}</td>
                    <td>
                        {% if trade.status == 'open' %}
                            <form action="/close-trade/{{ trade.id }}" method="POST">
                                <button type="submit">Close Trade</button>
                            </form>
                        {% else %}
                            <p>Closed</p>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            $('#trades').DataTable();
        });
    </script>
</body>
</html>
