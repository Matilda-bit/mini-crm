{# templates/dashboard/admin/admin.html.twig #}

{% extends 'base.html.twig' %}
{% block content %}

    {% include 'dashboard/user_info.html.twig' with {'user': user} %}

    {% include 'dashboard/agent/hierarchy_view.html.twig' with {'rep': rep, 'isRoot': true} %}
    {% include 'dashboard/tables/manage_users.html.twig' with {'users': users, 'agents': agents, 'route': 'admin'} %}
    {% include 'dashboard/tables/manage_agents.html.twig' with {'agents': agents, 'route': 'admin'} %}
    {% include 'dashboard/trade/_trade_table.html.twig' with {'trades': trades,'role': user.role} %}
    {% include 'dashboard/trade/_trade_form.html.twig' with {'users': users, 'is_agent': true} %}
    {% include 'dashboard/tables/_assets_view.html.twig' %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $(document).ready(function() {
            const table = $('#agentsTable').DataTable({
                dom: 'lrtip', // убираем стандартный input
                searching: true
            });

            $('#customSearch').on('keyup', function() {
                const selectedColumn = $('#columnSelect').val();
                const value = this.value;

                if (selectedColumn === 'all') {
                    table.search(value).draw(); // глобальный поиск
                } else {
                    table.search('').columns().search(''); // сброс всех фильтров
                    table.column(selectedColumn).search(value).draw(); // поиск по выбранной колонке
                }
            });

            $('#columnSelect').on('change', function() {
                $('#customSearch').trigger('keyup'); // сразу применить поиск при смене колонки
            });
        });
        $(document).ready(function() {
            const table = $('#usersTable').DataTable({
                dom: 'lrtip', // убираем стандартный input
                searching: true
            });

            $('#customSearch').on('keyup', function() {
                const selectedColumn = $('#columnSelect').val();
                const value = this.value;

                if (selectedColumn === 'all') {
                    table.search(value).draw(); // глобальный поиск
                } else {
                    table.search('').columns().search(''); // сброс всех фильтров
                    table.column(selectedColumn).search(value).draw(); // поиск по выбранной колонке
                }
            });

            $('#columnSelect').on('change', function() {
                $('#customSearch').trigger('keyup'); // сразу применить поиск при смене колонки
            });
        });

        $(document).ready(function() {
            $('#tradesTable').DataTable();
        });
    </script>
    
{% endblock %}